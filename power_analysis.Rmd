---
title: "Power Analysis"
author: "Mac Prible"
date: "2024-03-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("power_analysis_simulation.R")
```

# Aim 1

## Hypothesis: SLR moves significantly in same direction in all conditions

Planned comparisons are made between baseline and post adaptation within each condition. 
Powered to distinguish differences in interaction effect (i.e. PDSV may have half impact on SLR)
```{r}

# healthy population...anticipate symmetry
pre_means <-list(
  "cSBT" = 1,
  "FastProp" = 1,
  "FastBrake" = 1
)

post_means <-list(
  "cSBT" = 1.57, # from lauziere et al 2014
  "FastProp" = 1.3, # expect ~half impact
  "FastBrake" = 1.3 # expect ~half impact
)

# from Lauziere et al 2014; std_dev = .06 at baseline, 0.26 at Post Adapt. Straight average method used to pool (Cumming 2012)
std_dev <- .16
pre_std_devs <-list(
  "cSBT" = std_dev,
  "FastProp" = std_dev,
  "FastBrake" = std_dev
)

# cSBT from Lauzier et al 2014
# makes sense as greater variance expected after adaptation
post_std_devs <-list(
  "cSBT" = std_dev,
  "FastProp" = std_dev,
  "FastBrake" = std_dev
)
    
conditions <- list( "cSBT", "FastProp", "FastBrake" )
    
test_sample_sizes = 10:15
for (n in test_sample_sizes){
  
    num_simulations = 10
    
    # Running simulations in parallel
    aim_2_slr_results <- lapply(1:num_simulations, function(i) {
      simulate_aim(n, conditions, pre_means, pre_std_devs, post_means, post_std_devs)
    })
    
    # Computing success count and success rate
    success_count <- sum(unlist(aim_2_slr_results))
    success_rate <- success_count / num_simulations
    
    print(paste("For n = ", n, ", success rate is ", success_rate, " after ", num_simulations, " simulations."))
  
}

```


## Hypothesis: PF impulse increases in FastProp, decreases in other conditions

Planned comparisons are made between baseline and post adaptation within each condition. 
Powered to distinguish differences in interaction effect (i.e. PDSV may have half impact on SLR)
```{r}

# estimates here taken from subject 1 values; time normalized impulse across stance
pre_means <-list(
  "cSBT" = .415,
  "FastProp" = .415,
  "FastBrake" = 415
)

# subject 1: PF impulse  decrease in cSBT (as with Lauziere 2014) and fastBrake, increased with FastProp
post_means <-list(
  "cSBT" = .274,
  "FastProp" = .472, 
  "FastBrake" = .294
)

# estimates based on Allen et al (2011)
std_dev <- .0384

pre_std_devs <-list(
  "cSBT" = std_dev,
  "FastProp" = std_dev,
  "FastBrake" = std_dev
)

post_std_devs <-list(
  "cSBT" = std_dev,
  "FastProp" = std_dev,
  "FastBrake" = std_dev
)

conditions <- list( "cSBT", "FastProp", "FastBrake" )
       
test_sample_sizes = 10:15
for (n in test_sample_sizes){
  
    num_simulations = 100
    
    # Running simulations in parallel
    aim_2_pf_results <- lapply(1:num_simulations, function(i) {
      simulate_aim(n, conditions, pre_means, pre_std_devs, post_means, post_std_devs)
    })
    
    # Computing success count and success rate
    success_count <- sum(unlist(aim_2_pf_results))
    success_rate <- success_count / num_simulations
    
    print(paste("For n = ", n, ", success rate is ", success_rate, " after ", num_simulations, " simulations."))
  
}

```


# Aim 3

## Change PF Impulse Bilaterally in either direction


```{r}

# estimates here taken from subject 1 values; time normalized impulse across stance
pre_means <-list(
  "FastProp" = 450,
  "FastBrake" = 450
)

# subject 1: PF impulse decrease in cSBT (as with Lauziere 2014) and fastBrake, increased with FastProp
post_means <-list(
  "FastProp" = 535,
  "FastBrake" = 400
)

# estimates based on Allen et al (2011)
std_dev <- 50
pre_vars <-list(
  "FastProp" = std_dev,
  "FastBrake" = std_dev
)

# expecting increased variance following perturbation
post_vars <-list(
  "FastProp" = std_dev,
  "FastBrake" = std_dev
)
    
conditions <- list( "FastProp", "FastBrake" )
    
test_sample_sizes = 20:25
for (n in test_sample_sizes){
  
    num_simulations = 10
    
    # Running simulations in parallel
    aim_3_pf_results <- lapply(1:num_simulations, function(i) {
      simulate_aim(n, conditions, pre_means, pre_vars, post_means, post_vars)
    })
    
    # Computing success count and success rate
    success_count <- sum(unlist(aim_3_pf_results))
    success_rate <- success_count / num_simulations
    
    print(paste("For n = ", n, ", success rate is ", success_rate, " after ", num_simulations, " simulations."))
  
}

```
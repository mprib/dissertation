---
title: "Power Analysis"
author: "Mac Prible"
date: "2024-03-30"
output: html_document
---


https://pubmed.ncbi.nlm.nih.gov/22491174/

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("power_analysis_simulation.R")
```

# Study 2
## Hypothesis: SLR moves significantly in same direction in all conditions

Planned comparisons are made between baseline and post adaptation within each condition. 
```{r}

# healthy population...anticipate symmetry
pre_means <-list(
  "cSBT" = 1,
  "FastProp" = 1,
  "FastBrake" = 1
)

post_means <-list(
  "cSBT" = 1.472,
  "FastProp" = 1.262, 
  "FastBrake" = 1.317 
)


std_dev <- .0456
pre_std_devs <-list(
  "cSBT" = std_dev,
  "FastProp" = std_dev,
  "FastBrake" = std_dev
)

# cSBT from Lauzier et al 2014
# makes sense as greater variance expected after adaptation
std_dev <- 0.314
post_std_devs <-list(
  "cSBT" = std_dev,
  "FastProp" = std_dev,
  "FastBrake" = std_dev
)
    
conditions <- list( "cSBT", "FastProp", "FastBrake" )
    
test_sample_sizes = 10:15
for (n in test_sample_sizes){
  
    num_simulations = 100
    
    # Running simulations in parallel
    aim_2_slr_results <- lapply(1:num_simulations, function(i) {
      simulate_aim(n, conditions, pre_means, pre_std_devs, post_means, post_std_devs, correlation = 0.5, study = 2)
    })
    
    # Computing success count and success rate
    success_count <- sum(unlist(aim_2_slr_results))
    success_rate <- success_count / num_simulations
    
    print(paste("For n = ", n, ", success rate is ", success_rate, " after ", num_simulations, " simulations."))
  
}

```


## Hypothesis: PF impulse increases in FastProp, decreases in other conditions

Powered to distinguish differences in interaction effect (i.e. PDSV may have half impact on SLR)
```{r}

baseline_mean <- 0.38
pre_means <-list(
  "cSBT" = baseline_mean,
  "FastProp" = baseline_mean,
  "FastBrake" =baseline_mean
)

post_means <-list(
  "cSBT" = .31,
  "FastProp" = .41, 
  "FastBrake" = .29
)

std_dev <- .07
pre_std_devs <-list(
  "cSBT" = std_dev,
  "FastProp" = std_dev,
  "FastBrake" = std_dev
)

std_dev <- .10
post_std_devs <-list(
  "cSBT" = std_dev,
  "FastProp" = std_dev,
  "FastBrake" = std_dev
)

conditions <- list( "cSBT", "FastProp", "FastBrake" )
       
test_sample_sizes = 15:20
for (n in test_sample_sizes){
  
    num_simulations = 100
    
    # Running simulations in parallel
    aim_2_pf_results <- lapply(1:num_simulations, function(i) {
      simulate_aim(n, conditions, pre_means, pre_std_devs, post_means, post_std_devs, correlation=0.85, study=3)
    })
    
    # Computing success count and success rate
    success_count <- sum(unlist(aim_2_pf_results))
    success_rate <- success_count / num_simulations
    
    print(paste("For n = ", n, ", success rate is ", success_rate, " after ", num_simulations, " simulations."))
  
}

```


# Study 3

## Change PF Impulse Bilaterally in either direction


```{r}

# estimates here taken from subject 1 values; time normalized impulse across stance
pre_means <-list(
  "FastProp" = .373,
  "FastBrake" = .373
)

# subject 1: PF impulse decrease in cSBT (as with Lauziere 2014) and fastBrake, increased with FastProp
post_means <-list(
  "FastProp" = 0.46,
  "FastBrake" = 0.33
)

# estimates based on preliminary data (5 subjects)
pre_vars <-list(
  "FastProp" = .07,
  "FastBrake" = .07
)

# expecting increased variance following perturbation
post_vars <-list(
  "FastProp" = .12,
  "FastBrake" = .12
)
    
conditions <- list( "FastProp", "FastBrake" )
    
test_sample_sizes = 3:6
for (n in test_sample_sizes){
  
    num_simulations = 20
    
    # Running simulations in parallel
    aim_3_pf_results <- lapply(1:num_simulations, function(i) {
      simulate_aim(n, conditions, pre_means, pre_vars, post_means, post_vars, correlation = 0.8, study=3)
    })
    
    # Computing success count and success rate
    success_count <- sum(unlist(aim_3_pf_results))
    success_rate <- success_count / num_simulations
    
    print(paste("For n = ", n, ", success rate is ", success_rate, " after ", num_simulations, " simulations."))
  
}

```